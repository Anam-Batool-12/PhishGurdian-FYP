{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
    <h2 class="mb-3">üìù URL Scan History</h2>

    <!-- Session Logs -->
    <h4>Current Session</h4>
    {% if session_logs %}
        <ul class="list-group mb-3">
            {% for log in session_logs %}
                <li class="list-group-item">{{ log.url }} ‚Üí {{ log.result }}</li>
            {% endfor %}
        </ul>
    {% else %}
        <p>No URLs scanned in this session.</p>
    {% endif %}

    <!-- DB Logs -->
    <h4>Recent History (DB)</h4>
    {% if db_logs %}
        <table class="table table-striped">
            <thead>
                <tr><th>URL</th><th>Result</th><th>Checked At</th></tr>
            </thead>
            <tbody>
                {% for row in db_logs %}
                <tr>
                    <td>{{ row['url'] }}</td>
                    <td>{{ row['result'] }}</td>
                    <td>{{ row['checked_at'] }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>No logs found in database.</p>
    {% endif %}

    <!-- Chart.js -->
    <div class="mt-5">
        <h4>Scan Summary</h4>
        <canvas id="urlChart" width="400" height="200"></canvas>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    fetch("{{ url_for('chart_url_summary') }}")
      .then(res => res.json())
      .then(data => {
          new Chart(document.getElementById('urlChart'), {
              type: 'bar',
              data: {
                  labels: ['Safe', 'Phishing'],
                  datasets: [{
                      data: [data.safe, data.phishing],
                      backgroundColor: ['#28a745', '#dc3545']
                  }]
              }
          });
      });
</script>
{% endblock %}
